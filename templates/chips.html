{% extends "base.html" %}
{% block title %}Chips{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="titulo-pagina"><i class="fas fa-sim-card"></i> Gestão de Chips</h1>
    <p class="sub">Cadastro + Visualização em tempo real</p>
</div>

<div class="card form-card">
    <h2 class="card-title"><i class="fas fa-plus-circle"></i> Novo Chip</h2>

    <form action="/chips/add" method="POST" class="form-grid">
        <div class="form-group">
            <label>ID do Chip</label>
            <input type="text" name="id_chip" required>
        </div>

        <div class="form-group">
            <label>Número</label>
            <input type="text" name="numero" required>
        </div>

        <div class="form-group">
            <label>Operadora</label>
            <select name="operadora" required>
                <option value="VIVO">VIVO</option>
                <option value="TIM">TIM</option>
                <option value="CLARO">CLARO</option>
                <option value="OI">OI</option>
                <option value="OUTRA">OUTRA</option>
            </select>
        </div>

        <div class="form-group">
            <label>Plano</label>
            <input type="text" name="plano">
        </div>

        <div class="form-group">
            <label>Status</label>
            <select name="status" required>
                <option value="DISPONIVEL">DISPONÍVEL</option>
                <option value="MATURANDO">MATURANDO</option>
                <option value="MATURADO">MATURADO</option>
                <option value="DESCANSO_1">DESCANSO 1</option>
                <option value="DESCANSO_2">DESCANSO 2</option>
                <option value="PRONTO_PARA_MATURAR">PRONTO PARA MATURAR</option>
                <option value="DISPARANDO">DISPARANDO</option>
                <option value="BANIDO">BANIDO</option>
                <option value="RESTRINGIDO">RESTRINGIDO</option>
                <option value="ATIVO">ATIVO</option>
                <option value="BLOQUEADO">BLOQUEADO</option>
            </select>
        </div>

        <div class="form-group">
            <label>Data de início</label>
            <input type="date" name="dt_inicio">
        </div>

        <div class="form-group">
            <label>Valor última recarga</label>
            <input type="number" step="0.01" name="ultima_recarga_valor">
        </div>

        <div class="form-group">
            <label>Data última recarga</label>
            <input type="date" name="ultima_recarga_data">
        </div>

        <div class="form-group">
            <label>Total gasto</label>
            <input type="number" step="0.01" name="total_gasto">
        </div>

        <div class="form-group">
            <label>Aparelho Vinculado</label>
            <select name="sk_aparelho_atual">
                <option value="">-- Nenhum --</option>
                {% for ap in aparelhos %}
                    <option value="{{ ap.sk_aparelho }}">{{ ap.modelo }} ({{ ap.marca }})</option>
                {% endfor %}
            </select>
        </div>

        <button class="btn-primary" type="submit">Salvar</button>
    </form>
</div>


<div class="card table-card">
    <h2 class="card-title"><i class="fas fa-list"></i> Chips Cadastrados</h2>

    <table id="tabela-chips" class="display compact stripe">
        <thead>
            <tr>
                <th>ID</th>
                <th>Número</th>
                <th>Operadora</th>
                <th>Status</th>
                <th>Plano</th>
                <th>Última Recarga</th>
                <th>Valor (R$)</th>
                <th>Gasto Total</th>
                <th>Aparelho Atual</th>
                <th>Início</th>
            </tr>
        </thead>
        <tbody>
            {% for c in chips %}
            <tr>
                <td>{{ c.id_chip }}</td>
                <td>{{ c.numero }}</td>
                <td>{{ c.operadora }}</td>
                <td><span class="tag tag-{{ c.status }}">{{ c.status }}</span></td>
                <td>{{ c.plano }}</td>
                <td>{{ c.ultima_recarga_data }}</td>
                <td>{{ c.ultima_recarga_valor }}</td>
                <td>{{ c.total_gasto }}</td>
                <td>{{ c.sk_aparelho_atual }}</td>
                <td>{{ c.dt_inicio }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
$(document).ready(function () {
    $('#tabela-chips').DataTable({
        pageLength: 25,
        responsive: true,
        order: [[0, 'desc']]
    });
});
</script>

{% endblock %}
