{% extends "base.html" %}
{% block conteudo %}

<h2>Gerenciamento de Chips</h2>

<form id="form-add-chip" class="form-box">

    <label>ICCID</label>
    <input name="iccid" required>

    <label>Número</label>
    <input name="numero_chip" required>

    <label>Operadora</label>
    <input name="operadora" required>

    <label>Status</label>
    <select name="status_chip">
        <option>ATIVO</option>
        <option>BLOQUEADO</option>
        <option>CANCELADO</option>
    </select>

    <label>Data Ativação</label>
    <input name="data_ativacao" type="date">

    <label>Data Última Recarga</label>
    <input name="data_ultima_recarga" type="date">

    <label>Valor Última Recarga</label>
    <input name="valor_ultima_recarga" type="number" step="0.01">

    <button type="submit">Adicionar Chip</button>
</form>

<h2>Chips Cadastrados</h2>

<table class="tabela">
    <thead>
        <tr>
            <th>ICCID</th>
            <th>Número</th>
            <th>Operadora</th>
            <th>Status</th>
            <th>Última Recarga</th>
        </tr>
    </thead>
    <tbody>
    {% for c in chips %}
        <tr>
            <td>{{ c.iccid }}</td>
            <td>{{ c.numero_chip }}</td>
            <td>{{ c.operadora }}</td>
            <td>{{ c.status_chip }}</td>
            <td>{{ c.data_ultima_recarga or "—" }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<script>
document.querySelector("#form-add-chip").onsubmit = async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target));
    await fetch("/chips/add", {method: "POST", body: new URLSearchParams(data)});
    location.reload();
}
</script>

{% endblock %}
