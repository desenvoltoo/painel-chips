{% extends "base.html" %}
{% block conteudo %}

<style>
/* ====== CARDS DO DASHBOARD ====== */
.dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.card-kpi {
    background: #ffffff;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    transition: .2s ease-in-out;
}

.card-kpi:hover {
    transform: scale(1.03);
}

.kpi-title {
    font-size: 15px;
    font-weight: 600;
    color: #444;
    margin-bottom: 10px;
}

.kpi-value {
    font-size: 32px;
    font-weight: bold;
    color: #0077cc;
}

/* ====== FILTROS ====== */
.filtros-box {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.filtros-box select {
    padding: 8px 14px;
    border-radius: 8px;
    border: 1px solid #bbb;
    font-size: 15px;
}

/* ====== TABELA ====== */
.table-wrapper {
    background: #fff;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
}

table thead {
    background: #0077cc;
    color: white;
}

table thead th {
    padding: 10px;
}

table tbody td {
    padding: 8px;
    border-bottom: 1px solid #eee;
}

.status-tag {
    padding: 4px 8px;
    border-radius: 6px;
    color: #fff;
    font-size: 13px;
    text-transform: uppercase;
    font-weight: bold;
}

/* ===== CORES DOS STATUS ===== */
.status-DISPARANDO { background:#008000; }
.status-BANIDO { background:#cc0000; }
.status-MATURANDO { background:#ff9500; }
.status-MATURADO { background:#0066ff; }
.status-DESCANSO_1,
.status-DESCANSO_2 { background:#7a7a7a; }
.status-PRONTO_PARA_MATURAR { background:#3333aa; }
.status-DISPONIVEL { background:#0099cc; }
.status-RESTRINGIDO { background:#cc6600; }
.status-ATIVO { background:#555; }
.status-BLOQUEADO { background:#444; }

</style>


<h2>Painel Geral</h2>

<!-- ====================== CARDS ====================== -->
<div class="dashboard-cards">

    <div class="card-kpi">
        <div class="kpi-title">Total de Chips</div>
        <div class="kpi-value">{{ total_chips }}</div>
    </div>

    <div class="card-kpi">
        <div class="kpi-title">Chips Ativos</div>
        <div class="kpi-value">{{ chips_ativos }}</div>
    </div>

    <div class="card-kpi">
        <div class="kpi-title">Disparando</div>
        <div class="kpi-value">{{ disparando }}</div>
    </div>

    <div class="card-kpi">
        <div class="kpi-title">Banidos</div>
        <div class="kpi-value">{{ banidos }}</div>
    </div>

</div>


<!-- ====================== FILTROS ====================== -->
<h3>Filtros</h3>

<div class="filtros-box">
    <select id="filtro-status">
        <option value="">Filtrar por Status</option>
        {% for s in lista_status %}
        <option value="{{ s }}">{{ s }}</option>
        {% endfor %}
    </select>

    <select id="filtro-operadora">
        <option value="">Filtrar Operadora</option>
        {% for s in lista_operadora %}
        <option value="{{ s }}">{{ s }}</option>
        {% endfor %}
    </select>

    <select id="filtro-aparelho">
        <option value="">Filtrar Aparelho</option>
        {% for s in lista_aparelho %}
        <option value="{{ s }}">{{ s }}</option>
        {% endfor %}
    </select>
</div>


<!-- ====================== TABELA ====================== -->
<div class="table-wrapper">
    <table id="tabela-chips">
        <thead>
            <tr>
                <th>Chip</th>
                <th>Operadora</th>
                <th>Status</th>
                <th>Aparelho</th>
                <th>Plano</th>
                <th>Ãšltima Recarga</th>
            </tr>
        </thead>

        <tbody>
        {% for c in tabela %}
            <tr>
                <td>{{ c.numero }}</td>
                <td>{{ c.operadora }}</td>

                <td>
                    <span class="status-tag status-{{ c.status }}">
                        {{ c.status }}
                    </span>
                </td>

                <td>{{ c.nome_aparelho }}</td>
                <td>{{ c.plano }}</td>
                <td>{{ c.ultima_recarga_data }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
    const rows = Array.from(document.querySelectorAll("#tabela-chips tbody tr"));

    function filtrar() {
        const status = document.querySelector("#filtro-status").value.toLowerCase();
        const operadora = document.querySelector("#filtro-operadora").value.toLowerCase();
        const aparelho = document.querySelector("#filtro-aparelho").value.toLowerCase();

        rows.forEach(row => {
            const tStatus = row.children[2].innerText.toLowerCase();
            const tOperadora = row.children[1].innerText.toLowerCase();
            const tAparelho = row.children[3].innerText.toLowerCase();

            const match =
                (status === "" || tStatus.includes(status)) &&
                (operadora === "" || tOperadora.includes(operadora)) &&
                (aparelho === "" || tAparelho.includes(aparelho));

            row.style.display = match ? "" : "none";
        });
    }

    document.querySelector("#filtro-status").onchange = filtrar;
    document.querySelector("#filtro-operadora").onchange = filtrar;
    document.querySelector("#filtro-aparelho").onchange = filtrar;
});
</script>

{% endblock %}
