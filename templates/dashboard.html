{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h2 class="fw-bold mb-4">Dashboard Operacional</h2>

<div class="row g-4 mb-4">

    <!-- TOTAL CHIPS -->
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body text-center">
                <i class="bi bi-sim fs-1 text-primary"></i>
                <h5 class="mt-2 fw-bold">Total de Chips</h5>
                <h3 class="fw-bold">{{ kpis.total_chips }}</h3>
            </div>
        </div>
    </div>

    <!-- CHIPS ATIVOS -->
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body text-center">
                <i class="bi bi-check-circle fs-1 text-success"></i>
                <h5 class="mt-2 fw-bold">Chips Ativos</h5>
                <h3 class="fw-bold">{{ kpis.chips_ativos }}</h3>
            </div>
        </div>
    </div>

    <!-- APARELHOS -->
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body text-center">
                <i class="bi bi-phone fs-1 text-warning"></i>
                <h5 class="mt-2 fw-bold">Aparelhos</h5>
                <h3 class="fw-bold">{{ kpis.total_aparelhos }}</h3>
            </div>
        </div>
    </div>

    <!-- APARELHOS VINCULADOS -->
    <div class="col-md-3">
        <div class="card shadow-sm border-0">
            <div class="card-body text-center">
                <i class="bi bi-link-45deg fs-1 text-info"></i>
                <h5 class="mt-2 fw-bold">Vinculados</h5>
                <h3 class="fw-bold">{{ kpis.aparelhos_vinculados }}</h3>
            </div>
        </div>
    </div>
</div>

<hr class="my-4">

<h4 class="fw-bold mb-3">Últimas Recargas</h4>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Chip</th>
            <th>Operadora</th>
            <th>Data Última Recarga</th>
            <th>Valor</th>
        </tr>
    </thead>

    <tbody>
        {% for r in ultimas_recargas %}
        <tr>
            <td>{{ r.numero_chip }}</td>
            <td>{{ r.operadora }}</td>
            <td>{{ r.data_ultima_recarga }}</td>
            <td>R$ {{ "%.2f"|format(r.valor_ultima_recarga) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<hr class="my-4">

<h4 class="fw-bold">Tabela Consolidada (vw_chips_painel)</h4>

<table id="tabelaDashboard" class="table table-bordered">
    <thead>
        <tr>
            <th>Chip</th>
            <th>Operadora</th>
            <th>Status Chip</th>
            <th>Aparelho</th>
            <th>Modelo</th>
            <th>Data Vínculo</th>
            <th>Última Recarga</th>
            <th>Valor</th>
        </tr>
    </thead>
    <tbody>
        {% for row in tabela %}
        <tr>
            <td>{{ row.numero_chip }}</td>
            <td>{{ row.operadora }}</td>
            <td>{{ row.status_chip }}</td>
            <td>{{ row.nome_aparelho or "-" }}</td>
            <td>{{ row.modelo or "-" }}</td>
            <td>{{ row.data_vinculo or "-" }}</td>
            <td>{{ row.data_ultima_recarga or "-" }}</td>
            <td>{{ row.valor_ultima_recarga or "-" }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
$(document).ready(() => {
    $('#tabelaDashboard').DataTable({
        pageLength: 10,
        order: [[0, 'asc']]
    });
});
</script>

{% endblock %}
