{% extends "base.html" %}
{% block conteudo %}

<h2>Registrar Movimentação</h2>

<form id="form-mov" class="form-box">

    <label>Chip (SK)</label>
    <select name="sk_chip" required>
        {% for c in chips %}
            <option value="{{ c.sk_chip }}">{{ c.numero }} ({{ c.operadora }})</option>
        {% endfor %}
    </select>

    <label>Aparelho (SK)</label>
    <select name="sk_aparelho" required>
        {% for a in aparelhos %}
            <option value="{{ a.sk_aparelho }}">{{ a.modelo }} - {{ a.marca }}</option>
        {% endfor %}
    </select>

    <label>Data de Uso</label>
    <input type="date" name="data_uso" required>

    <label>Tipo Movimento</label>
    <select name="tipo_movimento">
        <option value="VINCULO">VÍNCULO</option>
        <option value="DESVINCULO">DESVÍNCULO</option>
        <option value="TROCA">TROCA</option>
    </select>

    <label>Origem</label>
    <input name="origem">

    <label>Observação</label>
    <input name="observacao">

    <button type="submit">Salvar Movimentação</button>
</form>

<h2>Movimentações Registradas</h2>

<table>
    <thead>
        <tr>
            <th>SK Fato</th>
            <th>SK Chip</th>
            <th>SK Aparelho</th>
            <th>Data</th>
            <th>Tipo</th>
            <th>Origem</th>
            <th>Obs</th>
        </tr>
    </thead>

    <tbody>
        {% for m in eventos %}
        <tr>
            <td>{{ m.sk_fato }}</td>
            <td>{{ m.sk_chip }}</td>
            <td>{{ m.sk_aparelho }}</td>
            <td>{{ m.data_uso }}</td>
            <td>{{ m.tipo_movimento }}</td>
            <td>{{ m.origem }}</td>
            <td>{{ m.observacao }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
document.querySelector("#form-mov").onsubmit = async e => {
    e.preventDefault();
    let data = Object.fromEntries(new FormData(e.target));
    await fetch("/movimentacao/add", { method:"POST", body:new URLSearchParams(data) });
    location.reload();
};
</script>

{% endblock %}
