{% extends "base.html" %}
{% block title %}Movimentação{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-random"></i> Movimentação de Chips</h1>
</div>

<div class="card form-card">
    <h2 class="card-title"><i class="fas fa-plus-circle"></i> Registrar Movimentação</h2>

    <form action="/movimentacao/add" method="POST" class="form-grid">

        <div class="form-group">
            <label>Chip</label>
            <select name="sk_chip" required>
                {% for c in chips %}
                    <option value="{{ c.sk_chip }}">{{ c.numero }} • {{ c.operadora }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Aparelho</label>
            <select name="sk_aparelho" required>
                {% for a in aparelhos %}
                    <option value="{{ a.sk_aparelho }}">{{ a.modelo }} • {{ a.marca }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Data</label>
            <input type="date" name="data_uso" required>
        </div>

        <div class="form-group">
            <label>Tipo</label>
            <select name="tipo_movimento">
                <option value="VINCULO">Vínculo</option>
                <option value="DESVINCULO">Desvínculo</option>
                <option value="TROCA">Troca</option>
            </select>
        </div>

        <div class="form-group">
            <label>Origem</label>
            <input type="text" name="origem">
        </div>

        <div class="form-group col-12">
            <label>Observação</label>
            <textarea name="observacao"></textarea>
        </div>

        <button class="btn-primary" type="submit">Salvar</button>
    </form>
</div>

<div class="card table-card">
    <h2 class="card-title"><i class="fas fa-list"></i> Últimos Registros</h2>

    <table id="tabela-eventos" class="display stripe compact">
        <thead>
            <tr>
                <th>Chip</th>
                <th>Aparelho</th>
                <th>Data</th>
                <th>Tipo</th>
                <th>Origem</th>
                <th>Obs</th>
            </tr>
        </thead>

        <tbody>
            {% for e in eventos %}
            <tr>
                <td>{{ e.sk_chip }}</td>
                <td>{{ e.sk_aparelho }}</td>
                <td>{{ e.data_uso }}</td>
                <td>{{ e.tipo_movimento }}</td>
                <td>{{ e.origem }}</td>
                <td>{{ e.observacao }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
$(document).ready(function () {
    $('#tabela-eventos').DataTable({
        pageLength: 20,
        order: [[2, 'desc']]
    });
});
</script>

{% endblock %}
